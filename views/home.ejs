<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="stylesheet" href="stylesheets/styles.css">
    <title>As the Crow Flies</title>
</head>
<body>

  <nav class="navbar bg-body-tertiary navbar-messaging">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">
        <img src="images/crowb.png" alt="" width="30" height="24" class="d-inline-block align-text-top">
        As the Crow Flies
      </a>
    </div>
  </nav>

  <div class="container messaging-content">
    <div class="row justify-content-around">

      <div class="col-3 friendui">
        <h3 class="text-center">Contacts</h3>
        <div class="overflow-auto friendlist">
        
        <div id="messaginglist" class="d-flex flex-column justify-content-between align-items-center mb-2">
          <div>

              <%
              if(friendlist.length > 0){
                friendlist.forEach(function(friend){
                    %>
                    <form action="/home" method="get">
                      <button class="friend d-flex flex-row justify-content-between align-items-center" type="submit">
                        <div class="profilepic overflow-hidden"><img src="" alt=""></div>
                        <p name="user"><%= friend.Username %></p>
                        <span class="badge bg-primary rounded-pill">5</span>
                      </button>
                    </form>
                    <%
                })
            } else {
                %>
                <div>
                    <p>Add some friends!</p>
                </div>
                <%
            }
            %> 

          </div>
        </div>
      </div>
      <button>+</button>
      </div>

      <div class="col-8 offset-1 messaging">
        <h3 class="text-center">Messaging</h3>
        
        
        <div class="col-3 friendmessaging friend d-flex align-items-center justify-content-between">
          <div class="messager overflow-hidden"><img src="" alt=""></div>
          <span>
            <% if (action == 'receive') {%> 
              <p><%= sendTo %></p>
              <% } %>        
          </span>
        </div>
        <div class="col-12 messages overflow-auto">
          <ul id="messageLog">
            <% if(action == 'login') {
              console.log(friendlist)%>

              <% } else { %>
          <% if(messages.length > 0) {
                messages.forEach((data) => {
                  %>
                    <li class="<%= data.SentFromID %> d-flex justify-content-end"><div class="toFriend"><%= data.Message %></div></li>
                  <%
                }) 
              } else {
                %>
                <li>Send a message to get the conversation started!</li>
                <%  
              }
              %>
          </ul>
          <% } %>
        </div>
        <div class="col-12 typing-box">
          <!--Need to add method here!-->
          <form action="/home/messages" method="post">
            <div class="mb-3">
              <textarea class="form-control" id="exampleFormControlTextarea1" name="message" rows="3"></textarea>
            </div>
            <div class="d-flex flex-row-reverse"><button type="submit">Send</button></div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <footer class="navbar bg-body-tertiary footer-messaging">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">
        <img src="images/crowb.png" alt="" width="30" height="24" class="d-inline-block align-text-top">
        As the Crow Flies
      </a>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js" integrity="sha384-zYPOMqeu1DAVkHiLqWBUTcbYfZ8osu1Nd6Z89ify25QV9guujx43ITvfi12/QExE" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.min.js" integrity="sha384-Y4oOpwW3duJdCWv5ly8SCFYWqFDsfob/3GkgExXKV4idmbt98QcxXYs9UoXAB7BZ" crossorigin="anonymous"></script>
  <script src="scripts/script.js"></script>
</body>
</html>